<!doctype html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="description" content="keep coding, keep foolish"/>
        <meta name="keywords" content="ä»£ç ,æ•°å­¦,æ•°æ®æŒ–æ˜,æœºå™¨å­¦ä¹ ,ç®—æ³•,ç¼–è¯‘å™¨,åˆ†å¸ƒå¼,PHP,Nginx"/>
        <meta name="author" content="å¼ æ´‹"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
        <title>CodingLabs - Nginxæ¨¡å—å¼€å‘å…¥é—¨
</title>
        <link rel="stylesheet" href="/assets/vendor/normalize.css"/>
        <link rel="stylesheet" href="/assets/vendor/google-code-prettify/prettify-solarized-dark.css"/>
        <link rel="stylesheet" href="/assets/themes/default/main.css"/>
        <link rel="shortcut icon" href="/fav.ico"/>
        <script type="text/javascript" src="/assets/vendor/google-code-prettify/prettify.js"></script>
        <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F75dfda8ff8a93fa0b94adeb17da37a2f' type='text/javascript'%3E%3C/script%3E"));
</script>

    </head>
    <body onload="prettyPrint()">
    <div id="header">
        <div id="header-inner">
            <div id="title"><a href="/">CodingLabs</a></div>
            <div id="subtitle">keep coding, keep foolish</div>
        </div>
    </div>

<div id="main">
    <div id="main-inner">
        <div id="topnav">
            <ul>
                <li><a href="/">é¦–é¡µ</a></li>
                <li class="sep"> | </li>
                <li><a href="/tag.html">æ ‡ç­¾</a></li>
                
<li class="sep"> | </li>
<li><a href="/pages/about-me.html" target="_self">å…³äºæˆ‘</a></li>

<li class="sep"> | </li>
<li><a href="/rss.xml" target="_self">+è®¢é˜…</a></li>

<li class="sep"> | </li>
<li><a href="https://github.com/ericzhang-cn/ailingbot" target="_blank">ğŸ¤–AilingBot - IMæœºå™¨äººæ¥å…¥AIèƒ½åŠ›çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ</a></li>


            </ul>
            <div style="clear:both;"></div>
        </div>
        <div id="article-title">
            <a href="/articles/intro-of-nginx-module-development.html">Nginxæ¨¡å—å¼€å‘å…¥é—¨</a>
        </div>
        <div id="article-meta">
            ä½œè€… å¼ æ´‹ | å‘å¸ƒäº 2011-10-18
        </div>
        <div id="article-tags">
        
        <a class="tag" href="/tag.html#Nginx">Nginx</a>
        
        <a class="tag" href="/tag.html#ç³»ç»Ÿæ‰©å±•å¼€å‘">ç³»ç»Ÿæ‰©å±•å¼€å‘</a>
        
        </div>
        <div id="article-content">
            <h1><a name="section0"></a>å‰è¨€</h1>
<p>Nginxæ˜¯å½“å‰æœ€æµè¡Œçš„HTTP Serverä¹‹ä¸€ï¼Œæ ¹æ®W3Techsçš„ç»Ÿè®¡ï¼Œç›®å‰ä¸–ç•Œæ’åï¼ˆæ ¹æ®Alexaï¼‰å‰100ä¸‡çš„ç½‘ç«™ä¸­ï¼Œ<a href="http://w3techs.com/technologies/overview/web_server/all" target="_blank">Nginxçš„å æœ‰ç‡ä¸º6.8%</a>ã€‚ä¸Apacheç›¸æ¯”ï¼Œ<a href="http://www.joeandmotorboat.com/2008/02/28/apache-vs-nginx-web-server-performance-deathmatch/" target="_blank">Nginxåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹å…·æœ‰å·¨å¤§çš„æ€§èƒ½ä¼˜åŠ¿</a>ã€‚</p>
<p>Nginxå±äºå…¸å‹çš„å¾®å†…æ ¸è®¾è®¡ï¼Œå…¶å†…æ ¸éå¸¸ç®€æ´å’Œä¼˜é›…ï¼ŒåŒæ—¶å…·æœ‰éå¸¸é«˜çš„å¯æ‰©å±•æ€§ã€‚Nginxæœ€åˆä»…ä»…ä¸»è¦è¢«ç”¨äºåšåå‘ä»£ç†ï¼Œåæ¥éšç€HTTPæ ¸å¿ƒçš„æˆç†Ÿå’Œå„ç§HTTPæ‰©å±•æ¨¡å—çš„ä¸°å¯Œï¼ŒNginxè¶Šæ¥è¶Šå¤šè¢«ç”¨æ¥å–ä»£Apacheè€Œå•ç‹¬æ‰¿æ‹…HTTP Serverçš„è´£ä»»ï¼Œä¾‹å¦‚ç›®å‰æ·˜å®å†…å„ä¸ªéƒ¨é—¨æ­£è¶Šæ¥è¶Šå¤šä½¿ç”¨Nginxå–ä»£Apacheï¼Œæ®ç¬”è€…äº†è§£ï¼Œåœ¨è…¾è®¯å’Œæ–°æµªç­‰å…¬å¸ä¹Ÿå­˜åœ¨ç±»ä¼¼æƒ…å†µã€‚</p>
<p>åŒæ—¶ï¼Œå¤§é‡çš„ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—ä¹Ÿä»¤Nginxè¶Šæ¥è¶Šå¼ºå¤§ã€‚ä¾‹å¦‚ï¼Œç”±æ·˜å®çš„å·¥ç¨‹å¸ˆæ¸…æ— ï¼ˆç‹æ™“å“²ï¼‰å’Œæ˜¥æ¥ï¼ˆç« äº¦æ˜¥ï¼‰æ‰€å¼€å‘çš„<a href="https://github.com/chaoslawful/lua-nginx-module" target="_blank">nginx_lua_module</a>å¯ä»¥å°†Luaè¯­è¨€åµŒå…¥åˆ°Nginxé…ç½®ä¸­ï¼Œä»è€Œåˆ©ç”¨Luaæå¤§å¢å¼ºäº†Nginxæœ¬èº«çš„ç¼–ç¨‹èƒ½åŠ›ï¼Œç”šè‡³å¯ä»¥ä¸ç”¨é…åˆå…¶å®ƒè„šæœ¬è¯­è¨€ï¼ˆå¦‚PHPæˆ–Pythonç­‰ï¼‰ï¼Œåªé Nginxæœ¬èº«å°±å¯ä»¥å®ç°å¤æ‚ä¸šåŠ¡çš„å¤„ç†ã€‚è€Œæ˜¥æ¥æ‰€å¼€å‘çš„<a href="https://github.com/agentzh/ngx_openresty" target="_blank">ngx_openresty</a>æ›´æ˜¯é€šè¿‡é›†æˆ<a href="http://luajit.org/" target="_blank">LuaJIT</a>ç­‰ç»„ä»¶ï¼Œå°†Nginxæœ¬èº«å˜æˆäº†ä¸€ä¸ªå®Œå…¨çš„åº”ç”¨å¼€å‘å¹³å°ã€‚ç›®å‰æ·˜å®æ•°æ®å¹³å°ä¸äº§å“éƒ¨é‡å­ç»Ÿè®¡çš„äº§å“éƒ½æ˜¯åŸºäºngx_openrestyæ‰€å¼€å‘ã€‚å¯¹ngxin_lua_moduleæˆ–ngx_openrestyæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å‚è€ƒæˆ‘åœ¨å…³é”®è¯ä¸Šç»™å‡ºçš„é“¾æ¥ï¼Œåç»­æˆ‘ä¹Ÿå¯èƒ½ä¼šå†™ä¸€äº›ä¸å…¶æœ‰å…³çš„æ–‡ç« ã€‚</p>
<p>æœ¬æ–‡å°†ä¼šé‡ç‚¹å…³æ³¨Nginxæ¨¡å—å¼€å‘å…¥é—¨åŠåŸºç¡€ã€‚ç›®å‰Nginxçš„å­¦ä¹ èµ„æ–™éå¸¸å°‘ï¼Œè€Œæ‰©å±•æ¨¡å—å¼€å‘ç›¸å…³çš„èµ„æ–™å‡ ä¹åªæœ‰ã€Š<a href="http://www.evanmiller.org/nginx-modules-guide.html" target="_blank">Emiller's Guide To Nginx Module Development</a>ã€‹ä¸€æ–‡ï¼Œæ­¤æ–‡ååˆ†ç»å…¸ï¼Œä½†æ˜¯ç”±äºNginxç‰ˆæœ¬çš„æ¼”è¿›ï¼Œå…¶ä¸­å°‘è®¸å†…å®¹å¯èƒ½æœ‰ç‚¹è¿‡æ—¶ã€‚æœ¬æ–‡æ˜¯ç¬”è€…åœ¨ç ”è¯»è¿™ç¯‡æ–‡ç« å’ŒNginxæºä»£ç çš„åŸºç¡€ä¸Šï¼Œå¯¹è‡ªå·±å­¦ä¹ Nginxæ¨¡å—å¼€å‘çš„ä¸€ä¸ªæ€»ç»“ã€‚æœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„æ¨¡å—å¼€å‘å®ä¾‹è®²è§£Nginxæ¨¡å—å¼€å‘çš„å…¥é—¨å†…å®¹ã€‚</p>
<p>æœ¬æ–‡å°†åŸºäºNginxæœ€æ–°çš„<a href="http://nginx.org/download/nginx-1.0.0.tar.gz" target="_blank">1.0.0</a>ç‰ˆæœ¬ï¼Œæ“ä½œç³»ç»Ÿç¯å¢ƒä¸ºLinuxï¼ˆUbuntu10.10ï¼‰ã€‚
<!--more-->
</p>
<h1><a name="section1"></a>Nginxæè¦</h1>
<p>å¼€å‘Nginxæ‰©å±•å½“ç„¶é¦–è¦å‰ææ˜¯å¯¹Nginxæœ‰ä¸€å®šçš„äº†è§£ï¼Œç„¶è€Œæœ¬æ–‡å¹¶ä¸æ‰“ç®—è¯¦ç»†é˜è¿°Nginxçš„æ–¹æ–¹é¢é¢ï¼Œè¯¸å¦‚Nginxçš„å®‰è£…å’Œå„ç§è¯¦ç»†é…ç½®ç­‰å†…å®¹éƒ½å¯ä»¥åœ¨Nginxå®˜ç½‘çš„Documentä¸­æ‰¾åˆ°ï¼Œæœ¬æ–‡åœ¨è¿™é‡Œåªä¼šæ¦‚æ‹¬æ€§æè¿°ä¸€äº›åé¢å¯èƒ½ä¼šç”¨åˆ°çš„åŸç†å’Œæ¦‚å¿µã€‚</p>
<h2><a name="section1-1"></a>Nginxåœ¨Linuxä¸‹çš„å®‰è£…ä¸è¿è¡Œ</h2>
<p>ä½¿ç”¨Nginxçš„ç¬¬ä¸€æ­¥æ˜¯ä¸‹è½½Nginxæºç åŒ…ï¼Œä¾‹å¦‚1.0.0çš„ä¸‹è½½åœ°å€ä¸º<a title="http://nginx.org/download/nginx-1.0.0.tar.gz" href="http://nginx.org/download/nginx-1.0.0.tar.gz">http://nginx.org/download/nginx-1.0.0.tar.gz</a>ã€‚ä¸‹è½½å®Œåç”¨tarå‘½ä»¤è§£å‹ç¼©ï¼Œè¿›å…¥ç›®å½•åå®‰è£…è¿‡ç¨‹ä¸Linuxä¸‹é€šå¸¸æ­¥éª¤æ— å¼‚ï¼Œä¾‹å¦‚æˆ‘æƒ³å°†Nginxå®‰è£…åˆ°/usr/local/nginxä¸‹ï¼Œåˆ™æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre class="prettyprint linenums">./configure --prefix=/usr/local/nginx
make
make install</pre>
<p>å®‰è£…å®Œæˆåå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯åŠ¨Nginxï¼š</p>
<pre class="prettyprint linenums">/usr/local/nginx/sbin/nginx</pre>
<p>Nginxé»˜è®¤ä»¥Deamonè¿›ç¨‹å¯åŠ¨ï¼Œè¾“å…¥ä¸‹åˆ—å‘½ä»¤ï¼š</p>
<pre class="prettyprint linenums">curl -i http://localhost/</pre>
<p>å°±å¯ä»¥æ£€æµ‹Nginxæ˜¯å¦å·²ç»æˆåŠŸè¿è¡Œã€‚æˆ–è€…ä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥<a href="http://localhost/">http://localhost/</a>ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°Nginxçš„æ¬¢è¿é¡µé¢äº†ã€‚å¯åŠ¨åå¦‚æœæƒ³åœæ­¢Nginxå¯ä»¥ä½¿ç”¨ï¼š</p>
<pre class="prettyprint linenums">/usr/local/nginx/sbin/nginx -s stop</pre>
<h2><a name="section1-2"></a>Nginxé…ç½®æ–‡ä»¶åŸºæœ¬ç»“æ„</h2>
<p>é…ç½®æ–‡ä»¶å¯ä»¥çœ‹åšæ˜¯Nginxçš„çµé­‚ï¼ŒNginxæœåŠ¡åœ¨å¯åŠ¨æ—¶ä¼šè¯»å…¥é…ç½®æ–‡ä»¶ï¼Œè€Œåç»­å‡ ä¹ä¸€åˆ‡åŠ¨ä½œè¡Œä¸ºéƒ½æ˜¯æŒ‰ç…§é…ç½®æ–‡ä»¶ä¸­çš„æŒ‡ä»¤è¿›è¡Œçš„ï¼Œå› æ­¤å¦‚æœå°†Nginxæœ¬èº«çœ‹åšä¸€ä¸ªè®¡ç®—æœºï¼Œé‚£ä¹ˆNginxçš„é…ç½®æ–‡ä»¶å¯ä»¥çœ‹æˆæ˜¯å…¨éƒ¨çš„ç¨‹åºæŒ‡ä»¤ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªNginxé…ç½®æ–‡ä»¶çš„å®ä¾‹ï¼š</p>
<pre class="prettyprint linenums">#user  nobody;
worker_processes  8;
error_log  logs/error.log;
pid        logs/nginx.pid;
events {
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    #tcp_nopush     on;
    keepalive_timeout  65;
    #gzip  on;

    server {
        listen       80;
        server_name  localhost;
        location / {
            root   /home/yefeng/www;
            index  index.html index.htm;
        }
        #error_page  404              /404.html;
        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
}</pre>
<p>Nginxé…ç½®æ–‡ä»¶æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œä½ å¯ä»¥ç”¨ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨å¦‚vimæˆ–emacsæ‰“å¼€å®ƒï¼Œé€šå¸¸å®ƒä¼šåœ¨nginxå®‰è£…ç›®å½•çš„confä¸‹ï¼Œå¦‚æˆ‘çš„nginxå®‰è£…åœ¨/usr/local/nginxï¼Œä¸»é…ç½®æ–‡ä»¶é»˜è®¤æ”¾åœ¨/usr/local/nginx/conf/nginx.confã€‚</p>
<p>å…¶ä¸­â€œ#â€è¡¨ç¤ºæ­¤è¡Œæ˜¯æ³¨é‡Šï¼Œç”±äºç¬”è€…ä¸ºäº†å­¦ä¹ æ‰©å±•å¼€å‘å®‰è£…äº†ä¸€ä¸ªçº¯å‡€çš„Nginxï¼Œå› æ­¤é…ç½®æ–‡ä»¶æ²¡æœ‰ç»è¿‡å¤ªå¤šæ”¹åŠ¨ã€‚</p>
<p>Nginxçš„é…ç½®æ–‡ä»¶æ˜¯ä»¥blockçš„å½¢å¼ç»„ç»‡çš„ï¼Œä¸€ä¸ªblocké€šå¸¸ä½¿ç”¨å¤§æ‹¬å·â€œ{}â€è¡¨ç¤ºã€‚blockåˆ†ä¸ºå‡ ä¸ªå±‚çº§ï¼Œæ•´ä¸ªé…ç½®æ–‡ä»¶ä¸ºmainå±‚çº§ï¼Œè¿™æ˜¯æœ€å¤§çš„å±‚çº§ï¼›åœ¨mainå±‚çº§ä¸‹å¯ä»¥æœ‰eventã€httpç­‰å±‚çº§ï¼Œè€Œhttpä¸­åˆä¼šæœ‰server blockï¼Œserver blockä¸­å¯ä»¥åŒ…å«location blockã€‚</p>
<p>æ¯ä¸ªå±‚çº§å¯ä»¥æœ‰è‡ªå·±çš„æŒ‡ä»¤ï¼ˆDirectiveï¼‰ï¼Œä¾‹å¦‚worker_processesæ˜¯ä¸€ä¸ªmainå±‚çº§æŒ‡ä»¤ï¼Œå®ƒæŒ‡å®šNginxæœåŠ¡çš„Workerè¿›ç¨‹æ•°é‡ã€‚æœ‰çš„æŒ‡ä»¤åªèƒ½åœ¨ä¸€ä¸ªå±‚çº§ä¸­é…ç½®ï¼Œå¦‚worker_processesåªèƒ½å­˜åœ¨äºmainä¸­ï¼Œè€Œæœ‰çš„æŒ‡ä»¤å¯ä»¥å­˜åœ¨äºå¤šä¸ªå±‚çº§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå­blockä¼šç»§æ‰¿çˆ¶blockçš„é…ç½®ï¼ŒåŒæ—¶å¦‚æœå­blocké…ç½®äº†ä¸çˆ¶blockä¸åŒçš„æŒ‡ä»¤ï¼Œåˆ™ä¼šè¦†ç›–æ‰çˆ¶blockçš„é…ç½®ã€‚æŒ‡ä»¤çš„æ ¼å¼æ˜¯â€œæŒ‡ä»¤å å‚æ•°1 å‚æ•°2 â€¦ å‚æ•°N;â€ï¼Œæ³¨æ„å‚æ•°é—´å¯ç”¨ä»»æ„æ•°é‡ç©ºæ ¼åˆ†éš”ï¼Œæœ€åè¦åŠ åˆ†å·ã€‚</p>
<p>åœ¨å¼€å‘Nginx HTTPæ‰©å±•æ¨¡å—è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯mainã€serverå’Œlocationä¸‰ä¸ªå±‚çº§ï¼Œå› ä¸ºæ‰©å±•æ¨¡å—é€šå¸¸å…è®¸æŒ‡å®šæ–°çš„é…ç½®æŒ‡ä»¤åœ¨è¿™ä¸‰ä¸ªå±‚çº§ä¸­ã€‚</p>
<p>æœ€åè¦æåˆ°çš„æ˜¯é…ç½®æ–‡ä»¶æ˜¯å¯ä»¥åŒ…å«çš„ï¼Œå¦‚ä¸Šé¢é…ç½®æ–‡ä»¶ä¸­â€œinclude mime.typesâ€å°±åŒ…å«äº†mine.typesè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶æŒ‡å®šäº†å„ç§HTTP Content-typeã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªserver blockè¡¨ç¤ºä¸€ä¸ªHostï¼Œè€Œé‡Œé¢çš„ä¸€ä¸ªlocationåˆ™ä»£è¡¨ä¸€ä¸ªè·¯ç”±æ˜ å°„è§„åˆ™ï¼Œè¿™ä¸¤ä¸ªblockå¯ä»¥è¯´æ˜¯HTTPé…ç½®çš„æ ¸å¿ƒã€‚</p>
<p>ä¸‹å›¾æ˜¯Nginxé…ç½®æ–‡ä»¶é€šå¸¸ç»“æ„å›¾ç¤ºã€‚</p>
<p class="picture"><img alt="" src="/uploads/pictures/intro-of-nginx-module-development/1.png"/></p>
<p>å…³äºNginxé…ç½®çš„æ›´å¤šå†…å®¹è¯·å‚çœ‹Nginxå®˜æ–¹æ–‡æ¡£ã€‚</p>
<h2><a name="section1-3"></a>Nginxæ¨¡å—å·¥ä½œåŸç†æ¦‚è¿°</h2>
<p>ï¼ˆNginxæœ¬èº«æ”¯æŒå¤šç§æ¨¡å—ï¼Œå¦‚HTTPæ¨¡å—ã€EVENTæ¨¡å—å’ŒMAILæ¨¡å—ï¼Œæœ¬æ–‡åªè®¨è®ºHTTPæ¨¡å—ï¼‰</p>
<p>Nginxæœ¬èº«åšçš„å·¥ä½œå®é™…å¾ˆå°‘ï¼Œå½“å®ƒæ¥åˆ°ä¸€ä¸ªHTTPè¯·æ±‚æ—¶ï¼Œå®ƒä»…ä»…æ˜¯é€šè¿‡æŸ¥æ‰¾é…ç½®æ–‡ä»¶å°†æ­¤æ¬¡è¯·æ±‚æ˜ å°„åˆ°ä¸€ä¸ªlocation blockï¼Œè€Œæ­¤locationä¸­æ‰€é…ç½®çš„å„ä¸ªæŒ‡ä»¤åˆ™ä¼šå¯åŠ¨ä¸åŒçš„æ¨¡å—å»å®Œæˆå·¥ä½œï¼Œå› æ­¤æ¨¡å—å¯ä»¥çœ‹åšNginxçœŸæ­£çš„åŠ³åŠ¨å·¥ä½œè€…ã€‚é€šå¸¸ä¸€ä¸ªlocationä¸­çš„æŒ‡ä»¤ä¼šæ¶‰åŠä¸€ä¸ªhandleræ¨¡å—å’Œå¤šä¸ªfilteræ¨¡å—ï¼ˆå½“ç„¶ï¼Œå¤šä¸ªlocationå¯ä»¥å¤ç”¨åŒä¸€ä¸ªæ¨¡å—ï¼‰ã€‚handleræ¨¡å—è´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œå®Œæˆå“åº”å†…å®¹çš„ç”Ÿæˆï¼Œè€Œfilteræ¨¡å—å¯¹å“åº”å†…å®¹è¿›è¡Œå¤„ç†ã€‚å› æ­¤Nginxæ¨¡å—å¼€å‘åˆ†ä¸ºhandlerå¼€å‘å’Œfilterå¼€å‘ï¼ˆæœ¬æ–‡ä¸è€ƒè™‘load-balanceræ¨¡å—ï¼‰ã€‚ä¸‹å›¾å±•ç¤ºäº†ä¸€æ¬¡å¸¸è§„è¯·æ±‚å’Œå“åº”çš„è¿‡ç¨‹ã€‚</p>
<p class="picture"><img alt="" src="/uploads/pictures/intro-of-nginx-module-development/2.png"/></p>
<h1><a name="section2"></a>Nginxæ¨¡å—å¼€å‘å®æˆ˜</h1>
<p>ä¸‹é¢æœ¬æ–‡å±•ç¤ºä¸€ä¸ªç®€å•çš„Nginxæ¨¡å—å¼€å‘å…¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¼€å‘ä¸€ä¸ªå«echoçš„handleræ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—åŠŸèƒ½éå¸¸ç®€å•ï¼Œå®ƒæ¥æ”¶â€œechoâ€æŒ‡ä»¤ï¼ŒæŒ‡ä»¤å¯æŒ‡å®šä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œæ¨¡å—ä¼šè¾“å‡ºè¿™ä¸ªå­—ç¬¦ä¸²ä½œä¸ºHTTPå“åº”ã€‚ä¾‹å¦‚ï¼Œåšå¦‚ä¸‹é…ç½®ï¼š</p>
<pre class="prettyprint linenums">location /echo {
    echo &quot;hello nginx&quot;;
}</pre>
<p>åˆ™è®¿é—®<a href="http://hostname/echo">http://hostname/echo</a>æ—¶ä¼šè¾“å‡ºhello nginxã€‚</p>
<p>ç›´è§‚æ¥çœ‹ï¼Œè¦å®ç°è¿™ä¸ªåŠŸèƒ½éœ€è¦ä¸‰æ­¥ï¼š1ã€è¯»å…¥é…ç½®æ–‡ä»¶ä¸­echoæŒ‡ä»¤åŠå…¶å‚æ•°ï¼›2ã€è¿›è¡ŒHTTPåŒ…è£…ï¼ˆæ·»åŠ HTTPå¤´ç­‰å·¥ä½œï¼‰ï¼›3ã€å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ä¸‹é¢æœ¬æ–‡å°†åˆ†éƒ¨ä»‹ç»æ•´ä¸ªæ¨¡å—çš„å¼€å‘è¿‡ç¨‹ã€‚</p>
<h2><a name="section2-1"></a>å®šä¹‰æ¨¡å—é…ç½®ç»“æ„</h2>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»“æ„ç”¨äºå­˜å‚¨ä»é…ç½®æ–‡ä»¶ä¸­è¯»è¿›æ¥çš„ç›¸å…³æŒ‡ä»¤å‚æ•°ï¼Œå³æ¨¡å—é…ç½®ä¿¡æ¯ç»“æ„ã€‚æ ¹æ®Nginxæ¨¡å—å¼€å‘è§„åˆ™ï¼Œè¿™ä¸ªç»“æ„çš„å‘½åè§„åˆ™ä¸ºngx_http_[module-name]_[main|srv|loc]_conf_tã€‚å…¶ä¸­mainã€srvå’Œlocåˆ†åˆ«ç”¨äºè¡¨ç¤ºåŒä¸€æ¨¡å—åœ¨ä¸‰å±‚blockä¸­çš„é…ç½®ä¿¡æ¯ã€‚è¿™é‡Œæˆ‘ä»¬çš„echoæ¨¡å—åªéœ€è¦è¿è¡Œåœ¨locå±‚çº§ä¸‹ï¼Œéœ€è¦å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹çš„æ¨¡å—é…ç½®ï¼š</p>
<pre class="prettyprint linenums">typedef struct {
    ngx_str_t  ed;
} ngx_http_echo_loc_conf_t;</pre>
<p>å…¶ä¸­å­—æ®µedç”¨äºå­˜å‚¨echoæŒ‡ä»¤æŒ‡å®šçš„éœ€è¦è¾“å‡ºçš„å­—ç¬¦ä¸²ã€‚æ³¨æ„è¿™é‡Œedçš„ç±»å‹ï¼Œåœ¨Nginxæ¨¡å—å¼€å‘ä¸­ä½¿ç”¨ngx_str_tç±»å‹è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªç±»å‹å®šä¹‰åœ¨core/ngx_stringä¸­ï¼š</p>
<pre class="prettyprint linenums">typedef struct {
    size_t      len;
    u_char     *data;
} ngx_str_t;</pre>
<p>å…¶ä¸­ä¸¤ä¸ªå­—æ®µåˆ†åˆ«è¡¨ç¤ºå­—ç¬¦ä¸²çš„é•¿åº¦å’Œæ•°æ®èµ·å§‹åœ°å€ã€‚æ³¨æ„åœ¨Nginxæºä»£ç ä¸­å¯¹æ•°æ®ç±»å‹è¿›è¡Œäº†åˆ«ç§°å®šä¹‰ï¼Œå¦‚ngx_int_tä¸ºintptr_tçš„åˆ«ç§°ï¼Œä¸ºäº†ä¿æŒä¸€è‡´ï¼Œåœ¨å¼€å‘Nginxæ¨¡å—æ—¶ä¹Ÿåº”è¯¥ä½¿ç”¨è¿™äº›Nginxæºç å®šä¹‰çš„ç±»å‹è€Œä¸è¦ä½¿ç”¨CåŸç”Ÿç±»å‹ã€‚é™¤äº†ngx_str_tå¤–ï¼Œå…¶å®ƒä¸‰ä¸ªå¸¸ç”¨çš„nginx typeåˆ†åˆ«ä¸ºï¼š</p>
<pre class="prettyprint linenums">typedef intptr_t        ngx_int_t;
typedef uintptr_t       ngx_uint_t;
typedef intptr_t        ngx_flag_t;</pre>
<p>å…·ä½“å®šä¹‰è¯·å‚çœ‹core/ngx_config.hã€‚å…³äºintptr_tå’Œuintptr_tè¯·å‚è€ƒC99ä¸­çš„<a href="http://linux.die.net/include/stdint.h" target="_blank">stdint.h</a>æˆ–<a title="http://linux.die.net/man/3/intptr_t" href="http://linux.die.net/man/3/intptr_t">http://linux.die.net/man/3/intptr_t</a>ã€‚</p>
<h2><a name="section2-2"></a>å®šä¹‰æŒ‡ä»¤</h2>
<p>ä¸€ä¸ªNginxæ¨¡å—å¾€å¾€æ¥æ”¶ä¸€è‡³å¤šä¸ªæŒ‡ä»¤ï¼Œechoæ¨¡å—æ¥æ”¶ä¸€ä¸ªæŒ‡ä»¤â€œechoâ€ã€‚Nginxæ¨¡å—ä½¿ç”¨ä¸€ä¸ªngx_command_tæ•°ç»„è¡¨ç¤ºæ¨¡å—æ‰€èƒ½æ¥æ”¶çš„æ‰€æœ‰æ¨¡å—ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ è¡¨ç¤ºä¸€ä¸ªæ¡æŒ‡ä»¤ã€‚ngx_command_tæ˜¯ngx_command_sçš„ä¸€ä¸ªåˆ«ç§°ï¼ˆNginxä¹ æƒ¯äºä½¿ç”¨â€œ_sâ€åç¼€å‘½åç»“æ„ä½“ï¼Œç„¶åtypedefä¸€ä¸ªåŒåâ€œ_tâ€åç¼€åç§°ä½œä¸ºæ­¤ç»“æ„ä½“çš„ç±»å‹åï¼‰ï¼Œngx_command_så®šä¹‰åœ¨core/ngx_config_file.hä¸­ï¼š</p>
<pre class="prettyprint linenums">struct ngx_command_s {
    ngx_str_t             name;
    ngx_uint_t            type;
    char               *(*set)(ngx_conf_t *cf, ngx_command_t *cmd, void *conf);
    ngx_uint_t            conf;
    ngx_uint_t            offset;
    void                 *post;
};</pre>
<p>å…¶ä¸­nameæ˜¯è¯æ¡æŒ‡ä»¤çš„åç§°ï¼Œtypeä½¿ç”¨æ©ç æ ‡å¿—ä½æ–¹å¼é…ç½®æŒ‡ä»¤å‚æ•°ï¼Œç›¸å…³å¯ç”¨typeå®šä¹‰åœ¨core/ngx_config_file.hä¸­ï¼š</p>
<pre class="prettyprint linenums">#define NGX_CONF_NOARGS      0x00000001
#define NGX_CONF_TAKE1       0x00000002
#define NGX_CONF_TAKE2       0x00000004
#define NGX_CONF_TAKE3       0x00000008
#define NGX_CONF_TAKE4       0x00000010
#define NGX_CONF_TAKE5       0x00000020
#define NGX_CONF_TAKE6       0x00000040
#define NGX_CONF_TAKE7       0x00000080
#define NGX_CONF_MAX_ARGS    8
#define NGX_CONF_TAKE12      (NGX_CONF_TAKE1|NGX_CONF_TAKE2)
#define NGX_CONF_TAKE13      (NGX_CONF_TAKE1|NGX_CONF_TAKE3)
#define NGX_CONF_TAKE23      (NGX_CONF_TAKE2|NGX_CONF_TAKE3)
#define NGX_CONF_TAKE123     (NGX_CONF_TAKE1|NGX_CONF_TAKE2|NGX_CONF_TAKE3)
#define NGX_CONF_TAKE1234    (NGX_CONF_TAKE1|NGX_CONF_TAKE2|NGX_CONF_TAKE3   \
        |NGX_CONF_TAKE4)
#define NGX_CONF_ARGS_NUMBER 0x000000ff
#define NGX_CONF_BLOCK       0x00000100
#define NGX_CONF_FLAG        0x00000200
#define NGX_CONF_ANY         0x00000400
#define NGX_CONF_1MORE       0x00000800
#define NGX_CONF_2MORE       0x00001000
#define NGX_CONF_MULTI       0x00002000</pre>
<p>å…¶ä¸­NGX_CONF_NOARGSè¡¨ç¤ºæ­¤æŒ‡ä»¤ä¸æ¥å—å‚æ•°ï¼ŒNGX_CON F_TAKE1-7è¡¨ç¤ºç²¾ç¡®æ¥æ”¶1-7ä¸ªï¼ŒNGX_CONF_TAKE12è¡¨ç¤ºæ¥å—1æˆ–2ä¸ªå‚æ•°ï¼ŒNGX_CONF_1MOREè¡¨ç¤ºè‡³å°‘ä¸€ä¸ªå‚æ•°ï¼ŒNGX_CONF_FLAGè¡¨ç¤ºæ¥å—â€œon|offâ€â€¦â€¦</p>
<p>setæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œç”¨äºæŒ‡å®šä¸€ä¸ªå‚æ•°è½¬åŒ–å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸€èˆ¬æ˜¯å°†é…ç½®æ–‡ä»¶ä¸­ç›¸å…³æŒ‡ä»¤çš„å‚æ•°è½¬åŒ–æˆéœ€è¦çš„æ ¼å¼å¹¶å­˜å…¥é…ç½®ç»“æ„ä½“ã€‚Nginxé¢„å®šä¹‰äº†ä¸€äº›è½¬æ¢å‡½æ•°ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬è°ƒç”¨ï¼Œè¿™äº›å‡½æ•°å®šä¹‰åœ¨core/ngx_conf_file.hä¸­ï¼Œä¸€èˆ¬ä»¥â€œ_slotâ€ç»“å°¾ï¼Œä¾‹å¦‚ngx_conf_set_flag_slotå°†â€œonæˆ–offâ€è½¬æ¢ä¸ºâ€œ1æˆ–0â€ï¼Œå†å¦‚ngx_conf_set_str_slotå°†è£¸å­—ç¬¦ä¸²è½¬åŒ–ä¸ºngx_str_tã€‚</p>
<p>confç”¨äºæŒ‡å®šNginxç›¸åº”é…ç½®æ–‡ä»¶å†…å­˜å…¶å®åœ°å€ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡å†…ç½®å¸¸é‡æŒ‡å®šï¼Œå¦‚NGX_HTTP_LOC_CONF_OFFSETï¼ŒoffsetæŒ‡å®šæ­¤æ¡æŒ‡ä»¤çš„å‚æ•°çš„åç§»é‡ã€‚</p>
<p>ä¸‹é¢æ˜¯echoæ¨¡å—çš„æŒ‡ä»¤å®šä¹‰ï¼š</p>
<pre class="prettyprint linenums">static ngx_command_t  ngx_http_echo_commands[] = {
    { ngx_string(&quot;echo&quot;),
        NGX_HTTP_LOC_CONF|NGX_CONF_TAKE1,
        ngx_http_echo,
        NGX_HTTP_LOC_CONF_OFFSET,
        offsetof(ngx_http_echo_loc_conf_t, ed),
        NULL },
        ngx_null_command
};</pre>
<p>æŒ‡ä»¤æ•°ç»„çš„å‘½åè§„åˆ™ä¸ºngx_http_[module-name]_commandsï¼Œæ³¨æ„æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ è¦æ˜¯ngx_null_commandç»“æŸã€‚</p>
<p>å‚æ•°è½¬åŒ–å‡½æ•°çš„ä»£ç ä¸ºï¼š</p>
<pre class="prettyprint linenums">static char *
ngx_http_echo(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
{
    ngx_http_core_loc_conf_t  *clcf;
    clcf = ngx_http_conf_get_module_loc_conf(cf, ngx_http_core_module);
    clcf-&gt;handler = ngx_http_echo_handler;
    ngx_conf_set_str_slot(cf,cmd,conf);
    return NGX_CONF_OK;
}</pre>
<p>è¿™ä¸ªå‡½æ•°é™¤äº†è°ƒç”¨ngx_conf_set_str_slotè½¬åŒ–echoæŒ‡ä»¤çš„å‚æ•°å¤–ï¼Œè¿˜å°†ä¿®æ”¹äº†æ ¸å¿ƒæ¨¡å—é…ç½®ï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªlocationçš„é…ç½®ï¼‰ï¼Œå°†å…¶handleræ›¿æ¢ä¸ºæˆ‘ä»¬ç¼–å†™çš„handlerï¼šngx_http_echo_handlerã€‚è¿™æ ·å°±å±è”½äº†æ­¤locationçš„é»˜è®¤handlerï¼Œä½¿ç”¨ngx_http_echo_handleräº§ç”ŸHTTPå“åº”ã€‚</p>
<h2><a name="section2-3"></a>åˆ›å»ºåˆå¹¶é…ç½®ä¿¡æ¯</h2>
<p>ä¸‹ä¸€æ­¥æ˜¯å®šä¹‰æ¨¡å—Contextã€‚</p>
<p>è¿™é‡Œé¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªngx_http_module_tç±»å‹çš„ç»“æ„ä½“å˜é‡ï¼Œå‘½åè§„åˆ™ä¸ºngx_http_[module-name]_module_ctxï¼Œè¿™ä¸ªç»“æ„ä¸»è¦ç”¨äºå®šä¹‰å„ä¸ªHookå‡½æ•°ã€‚ä¸‹é¢æ˜¯echoæ¨¡å—çš„contextç»“æ„ï¼š</p>
<pre class="prettyprint linenums">static ngx_http_module_t  ngx_http_echo_module_ctx = {
    NULL,                                  /* preconfiguration */
    NULL,                                  /* postconfiguration */
    NULL,                                  /* create main configuration */
    NULL,                                  /* init main configuration */
    NULL,                                  /* create server configuration */
    NULL,                                  /* merge server configuration */
    ngx_http_echo_create_loc_conf,         /* create location configration */
    ngx_http_echo_merge_loc_conf           /* merge location configration */
};</pre>
<p>å¯ä»¥çœ‹åˆ°ä¸€å…±æœ‰8ä¸ªHookæ³¨å…¥ç‚¹ï¼Œåˆ†åˆ«ä¼šåœ¨ä¸åŒæ—¶åˆ»è¢«Nginxè°ƒç”¨ï¼Œç”±äºæˆ‘ä»¬çš„æ¨¡å—ä»…ä»…ç”¨äºlocationåŸŸï¼Œè¿™é‡Œå°†ä¸éœ€è¦çš„æ³¨å…¥ç‚¹è®¾ä¸ºNULLå³å¯ã€‚å…¶ä¸­create_loc_confç”¨äºåˆå§‹åŒ–ä¸€ä¸ªé…ç½®ç»“æ„ä½“ï¼Œå¦‚ä¸ºé…ç½®ç»“æ„ä½“åˆ†é…å†…å­˜ç­‰å·¥ä½œï¼›merge_loc_confç”¨äºå°†å…¶çˆ¶blockçš„é…ç½®ä¿¡æ¯åˆå¹¶åˆ°æ­¤ç»“æ„ä½“ä¸­ï¼Œä¹Ÿå°±æ˜¯å®ç°é…ç½®çš„ç»§æ‰¿ã€‚è¿™ä¸¤ä¸ªå‡½æ•°ä¼šè¢«Nginxè‡ªåŠ¨è°ƒç”¨ã€‚æ³¨æ„è¿™é‡Œçš„å‘½åè§„åˆ™ï¼šngx_http_[module-name]_[create|merge]_[main|srv|loc]_confã€‚</p>
<p>ä¸‹é¢æ˜¯echoæ¨¡å—è¿™ä¸ªä¸¤ä¸ªå‡½æ•°çš„ä»£ç ï¼š
<pre class="prettyprint linenums">static void *
ngx_http_echo_create_loc_conf(ngx_conf_t *cf)
{
    ngx_http_echo_loc_conf_t  *conf;
    conf = ngx_pcalloc(cf-&gt;pool, sizeof(ngx_http_echo_loc_conf_t));
    if (conf == NULL) {
        return NGX_CONF_ERROR;
    }
    conf-&gt;ed.len = 0;
    conf-&gt;ed.data = NULL;
    return conf;
}
static char *
ngx_http_echo_merge_loc_conf(ngx_conf_t *cf, void *parent, void *child)
{
    ngx_http_echo_loc_conf_t *prev = parent;
    ngx_http_echo_loc_conf_t *conf = child;
    ngx_conf_merge_str_value(conf-&gt;ed, prev-&gt;ed, &quot;&quot;);
    return NGX_CONF_OK;
}</pre>
<p>å…¶ä¸­ngx_pcallocç”¨äºåœ¨Nginxå†…å­˜æ± ä¸­åˆ†é…ä¸€å—ç©ºé—´ï¼Œæ˜¯pcallocçš„ä¸€ä¸ªåŒ…è£…ã€‚ä½¿ç”¨ngx_pcallocåˆ†é…çš„å†…å­˜ç©ºé—´ä¸å¿…æ‰‹å·¥freeï¼ŒNginxä¼šè‡ªè¡Œç®¡ç†ï¼Œåœ¨é€‚å½“æ˜¯å¦é‡Šæ”¾ã€‚</p>
<p>create_loc_confæ–°å»ºä¸€ä¸ªngx_http_echo_loc_conf_tï¼Œåˆ†é…å†…å­˜ï¼Œå¹¶åˆå§‹åŒ–å…¶ä¸­çš„æ•°æ®ï¼Œç„¶åè¿”å›è¿™ä¸ªç»“æ„çš„æŒ‡é’ˆï¼›merge_loc_confå°†çˆ¶blockåŸŸçš„é…ç½®ä¿¡æ¯åˆå¹¶åˆ°create_loc_confæ–°å»ºçš„é…ç½®ç»“æ„ä½“ä¸­ã€‚</p>
<p>å…¶ä¸­ngx_conf_merge_str_valueä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªå®ï¼Œå…¶å®šä¹‰åœ¨core/ngx_conf_file.hä¸­ï¼š</p>
<pre class="prettyprint linenums">#define ngx_conf_merge_str_value(conf, prev, default)                        \
    if (conf.data == NULL) {                                                 \
        if (prev.data) {                                                     \
            conf.len = prev.len;                                             \
            conf.data = prev.data;                                           \
        } else {                                                             \
            conf.len = sizeof(default) - 1;                                  \
            conf.data = (u_char *) default;                                  \
        }                                                                    \
    }</pre>
<p>åŒæ—¶å¯ä»¥çœ‹åˆ°ï¼Œcore/ngx_conf_file.hè¿˜å®šä¹‰äº†å¾ˆå¤šmerge valueçš„å®ç”¨äºmergeå„ç§æ•°æ®ã€‚å®ƒä»¬çš„è¡Œä¸ºæ¯”è¾ƒç›¸ä¼¼ï¼šä½¿ç”¨prevå¡«å……confï¼Œå¦‚æœprevçš„æ•°æ®ä¸ºç©ºåˆ™ä½¿ç”¨defaultå¡«å……ã€‚</p>
<h2><a name="section2-4"></a>ç¼–å†™Handler</h2>
<p>ä¸‹é¢çš„å·¥ä½œæ˜¯ç¼–å†™handlerã€‚handlerå¯ä»¥è¯´æ˜¯æ¨¡å—ä¸­çœŸæ­£å¹²æ´»çš„ä»£ç ï¼Œå®ƒä¸»è¦æœ‰ä»¥ä¸‹å››é¡¹èŒè´£ï¼š</p>
<p>è¯»å…¥æ¨¡å—é…ç½®ã€‚</p>
<p>å¤„ç†åŠŸèƒ½ä¸šåŠ¡ã€‚</p>
<p>äº§ç”ŸHTTP headerã€‚</p>
<p>äº§ç”ŸHTTP bodyã€‚</p>
<p>ä¸‹é¢å…ˆè´´å‡ºechoæ¨¡å—çš„ä»£ç ï¼Œç„¶åé€šè¿‡åˆ†æä»£ç çš„æ–¹å¼ä»‹ç»å¦‚ä½•å®ç°è¿™å››æ­¥ã€‚è¿™ä¸€å—çš„ä»£ç æ¯”è¾ƒå¤æ‚ï¼š</p>
<pre class="prettyprint linenums">static ngx_int_t
ngx_http_echo_handler(ngx_http_request_t *r)
{
    ngx_int_t rc;
    ngx_buf_t *b;
    ngx_chain_t out;
    ngx_http_echo_loc_conf_t *elcf;
    elcf = ngx_http_get_module_loc_conf(r, ngx_http_echo_module);
    if(!(r-&gt;method &amp; (NGX_HTTP_HEAD|NGX_HTTP_GET|NGX_HTTP_POST)))
    {
        return NGX_HTTP_NOT_ALLOWED;
    }
    r-&gt;headers_out.content_type.len = sizeof(&quot;text/html&quot;) - 1;
    r-&gt;headers_out.content_type.data = (u_char *) &quot;text/html&quot;;
    r-&gt;headers_out.status = NGX_HTTP_OK;
    r-&gt;headers_out.content_length_n = elcf-&gt;ed.len;
    if(r-&gt;method == NGX_HTTP_HEAD)
    {
        rc = ngx_http_send_header(r);
        if(rc != NGX_OK)
        {
            return rc;
        }
    }
    b = ngx_pcalloc(r-&gt;pool, sizeof(ngx_buf_t));
    if(b == NULL)
    {
        ngx_log_error(NGX_LOG_ERR, r-&gt;connection-&gt;log, 0, &quot;Failed to allocate response buffer.&quot;);
        return NGX_HTTP_INTERNAL_SERVER_ERROR;
    }
    out.buf = b;
    out.next = NULL;
    b-&gt;pos = elcf-&gt;ed.data;
    b-&gt;last = elcf-&gt;ed.data + (elcf-&gt;ed.len);
    b-&gt;memory = 1;
    b-&gt;last_buf = 1;
    rc = ngx_http_send_header(r);
    if(rc != NGX_OK)
    {
        return rc;
    }
    return ngx_http_output_filter(r, &amp;out);
}</pre>
<p>handlerä¼šæ¥æ”¶ä¸€ä¸ªngx_http_request_tæŒ‡é’ˆç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å‘ä¸€ä¸ªngx_http_request_tç»“æ„ä½“ï¼Œæ­¤ç»“æ„ä½“å­˜å‚¨äº†è¿™æ¬¡HTTPè¯·æ±‚çš„ä¸€äº›ä¿¡æ¯ï¼Œè¿™ä¸ªç»“æ„å®šä¹‰åœ¨http/ngx_http_request.hä¸­ï¼š</p>
<pre class="prettyprint linenums">struct ngx_http_request_s {
    uint32_t                          signature;         /* &quot;HTTP&quot; */
    ngx_connection_t                 *connection;
    void                            **ctx;
    void                            **main_conf;
    void                            **srv_conf;
    void                            **loc_conf;
    ngx_http_event_handler_pt         read_event_handler;
    ngx_http_event_handler_pt         write_event_handler;
#if (NGX_HTTP_CACHE)
    ngx_http_cache_t                 *cache;
#endif
    ngx_http_upstream_t              *upstream;
    ngx_array_t                      *upstream_states;
    /* of ngx_http_upstream_state_t */
    ngx_pool_t                       *pool;
    ngx_buf_t                        *header_in;
    ngx_http_headers_in_t             headers_in;
    ngx_http_headers_out_t            headers_out;
    ngx_http_request_body_t          *request_body;
    time_t                            lingering_time;
    time_t                            start_sec;
    ngx_msec_t                        start_msec;
    ngx_uint_t                        method;
    ngx_uint_t                        http_version;
    ngx_str_t                         request_line;
    ngx_str_t                         uri;
    ngx_str_t                         args;
    ngx_str_t                         exten;
    ngx_str_t                         unparsed_uri;
    ngx_str_t                         method_name;
    ngx_str_t                         http_protocol;
    ngx_chain_t                      *out;
    ngx_http_request_t               *main;
    ngx_http_request_t               *parent;
    ngx_http_postponed_request_t     *postponed;
    ngx_http_post_subrequest_t       *post_subrequest;
    ngx_http_posted_request_t        *posted_requests;
    ngx_http_virtual_names_t         *virtual_names;
    ngx_int_t                         phase_handler;
    ngx_http_handler_pt               content_handler;
    ngx_uint_t                        access_code;
    ngx_http_variable_value_t        *variables;
    /* ... */
}</pre>
<p>ç”±äºngx_http_request_så®šä¹‰æ¯”è¾ƒé•¿ï¼Œè¿™é‡Œæˆ‘åªæˆªå–äº†ä¸€éƒ¨åˆ†ã€‚å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰è¯¸å¦‚uriï¼Œargså’Œrequest_bodyç­‰HTTPå¸¸ç”¨ä¿¡æ¯ã€‚è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„å‡ ä¸ªå­—æ®µæ˜¯headers_inã€headers_outå’Œchainï¼Œå®ƒä»¬åˆ†åˆ«è¡¨ç¤ºrequest headerã€response headerå’Œè¾“å‡ºæ•°æ®ç¼“å†²åŒºé“¾è¡¨ï¼ˆç¼“å†²åŒºé“¾è¡¨æ˜¯Nginx I/Oä¸­çš„é‡è¦å†…å®¹ï¼Œåé¢ä¼šå•ç‹¬ä»‹ç»ï¼‰ã€‚</p>
<p>ç¬¬ä¸€æ­¥æ˜¯è·å–æ¨¡å—é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸€å—åªè¦ç®€å•ä½¿ç”¨ngx_http_get_module_loc_confå°±å¯ä»¥äº†ã€‚</p>
<p>ç¬¬äºŒæ­¥æ˜¯åŠŸèƒ½é€»è¾‘ï¼Œå› ä¸ºechoæ¨¡å—éå¸¸ç®€å•ï¼Œåªæ˜¯ç®€å•è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰åŠŸèƒ½é€»è¾‘ä»£ç ã€‚</p>
<p>ç¬¬ä¸‰æ­¥æ˜¯è®¾ç½®response headerã€‚Headerå†…å®¹å¯ä»¥é€šè¿‡å¡«å……headers_outå®ç°ï¼Œæˆ‘ä»¬è¿™é‡Œåªè®¾ç½®äº†Content-typeå’ŒContent-lengthç­‰åŸºæœ¬å†…å®¹ï¼Œngx_http_headers_out_tå®šä¹‰äº†æ‰€æœ‰å¯ä»¥è®¾ç½®çš„HTTP Response Headerä¿¡æ¯ï¼š</p>
<pre class="prettyprint linenums">typedef struct {
    ngx_list_t                        headers;
    ngx_uint_t                        status;
    ngx_str_t                         status_line;
    ngx_table_elt_t                  *server;
    ngx_table_elt_t                  *date;
    ngx_table_elt_t                  *content_length;
    ngx_table_elt_t                  *content_encoding;
    ngx_table_elt_t                  *location;
    ngx_table_elt_t                  *refresh;
    ngx_table_elt_t                  *last_modified;
    ngx_table_elt_t                  *content_range;
    ngx_table_elt_t                  *accept_ranges;
    ngx_table_elt_t                  *www_authenticate;
    ngx_table_elt_t                  *expires;
    ngx_table_elt_t                  *etag;
    ngx_str_t                        *override_charset;
    size_t                            content_type_len;
    ngx_str_t                         content_type;
    ngx_str_t                         charset;
    u_char                           *content_type_lowcase;
    ngx_uint_t                        content_type_hash;
    ngx_array_t                       cache_control;
    off_t                             content_length_n;
    time_t                            date_time;
    time_t                            last_modified_time;
} ngx_http_headers_out_t;</pre>
<p>è¿™é‡Œå¹¶ä¸åŒ…å«æ‰€æœ‰HTTPå¤´ä¿¡æ¯ï¼Œå¦‚æœéœ€è¦å¯ä»¥ä½¿ç”¨agentzhï¼ˆæ˜¥æ¥ï¼‰å¼€å‘çš„Nginxæ¨¡å—<a href="http://wiki.nginx.org/HttpHeadersMoreModule" target="_blank">HttpHeadersMore</a>åœ¨æŒ‡ä»¤ä¸­æŒ‡å®šæ›´å¤šçš„Headerå¤´ä¿¡æ¯ã€‚</p>
<p>è®¾ç½®å¥½å¤´ä¿¡æ¯åä½¿ç”¨ngx_http_send_headerå°±å¯ä»¥å°†å¤´ä¿¡æ¯è¾“å‡ºï¼Œngx_http_send_headeræ¥å—ä¸€ä¸ªngx_http_request_tç±»å‹çš„å‚æ•°ã€‚</p>
<p>ç¬¬å››æ­¥ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥æ˜¯è¾“å‡ºResponse bodyã€‚è¿™é‡Œé¦–å…ˆè¦äº†è§£Nginxçš„I/Oæœºåˆ¶ï¼ŒNginxå…è®¸handlerä¸€æ¬¡äº§ç”Ÿä¸€ç»„è¾“å‡ºï¼Œå¯ä»¥äº§ç”Ÿå¤šæ¬¡ï¼ŒNginxå°†è¾“å‡ºç»„ç»‡æˆä¸€ä¸ªå•é“¾è¡¨ç»“æ„ï¼Œé“¾è¡¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªchain_tï¼Œå®šä¹‰åœ¨core/ngx_buf.hï¼š</p>
<pre class="prettyprint linenums">struct ngx_chain_s {
    ngx_buf_t    *buf;
    ngx_chain_t  *next;
};</pre>
<p>å…¶ä¸­ngx_chain_tæ˜¯ngx_chain_sçš„åˆ«åï¼Œbufä¸ºæŸä¸ªæ•°æ®ç¼“å†²åŒºçš„æŒ‡é’ˆï¼ŒnextæŒ‡å‘ä¸‹ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„é“¾è¡¨ã€‚ngx_buf_tçš„å®šä¹‰æ¯”è¾ƒé•¿è€Œä¸”å¾ˆå¤æ‚ï¼Œè¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†ï¼Œè¯·è‡ªè¡Œå‚è€ƒcore/ngx_buf.hã€‚ngx_but_tä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯poså’Œlastï¼Œåˆ†åˆ«è¡¨ç¤ºè¦ç¼“å†²åŒºæ•°æ®åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€å’Œç»“å°¾åœ°å€ï¼Œè¿™é‡Œæˆ‘ä»¬å°†é…ç½®ä¸­å­—ç¬¦ä¸²ä¼ è¿›å»ï¼Œlast_bufæ˜¯ä¸€ä¸ªä½åŸŸï¼Œè®¾ä¸º1è¡¨ç¤ºæ­¤ç¼“å†²åŒºæ˜¯é“¾è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¸º0è¡¨ç¤ºåé¢è¿˜æœ‰å…ƒç´ ã€‚å› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ç»„æ•°æ®ï¼Œæ‰€ä»¥ç¼“å†²åŒºé“¾è¡¨ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœéœ€è¦è¾“å…¥å¤šç»„æ•°æ®å¯å°†å„ç»„æ•°æ®æ”¾å…¥ä¸åŒç¼“å†²åŒºåæ’å…¥åˆ°é“¾è¡¨ã€‚ä¸‹å›¾å±•ç¤ºäº†Nginxç¼“å†²é“¾è¡¨çš„ç»“æ„ï¼š</p>
<p class="picture"><img alt="" src="/uploads/pictures/intro-of-nginx-module-development/3.png"/></p>
<p>ç¼“å†²æ•°æ®å‡†å¤‡å¥½åï¼Œç”¨ngx_http_output_filterå°±å¯ä»¥è¾“å‡ºäº†ï¼ˆä¼šé€åˆ°filterè¿›è¡Œå„ç§è¿‡æ»¤å¤„ç†ï¼‰ã€‚ngx_http_output_filterçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºngx_http_request_tç»“æ„ï¼Œç¬¬äºŒä¸ªä¸ºè¾“å‡ºé“¾è¡¨çš„èµ·å§‹åœ°å€&amp;outã€‚ngx_http_out_put_filterä¼šéå†é“¾è¡¨ï¼Œè¾“å‡ºæ‰€æœ‰æ•°æ®ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯handlerçš„æ‰€æœ‰å·¥ä½œï¼Œè¯·å¯¹ç…§æè¿°ç†è§£ä¸Šé¢è´´å‡ºçš„handlerä»£ç ã€‚</p>
<h2>ç»„åˆNginx Module</h2>
<p>ä¸Šé¢å®Œæˆäº†Nginxæ¨¡å—å„ç§ç»„ä»¶çš„å¼€å‘ä¸‹é¢å°±æ˜¯å°†è¿™äº›ç»„åˆèµ·æ¥äº†ã€‚ä¸€ä¸ªNginxæ¨¡å—è¢«å®šä¹‰ä¸ºä¸€ä¸ªngx_module_tç»“æ„ï¼Œè¿™ä¸ªç»“æ„çš„å­—æ®µå¾ˆå¤šï¼Œä¸è¿‡å¼€å¤´å’Œç»“å°¾è‹¥å¹²å­—æ®µä¸€èˆ¬å¯ä»¥é€šè¿‡Nginxå†…ç½®çš„å®å»å¡«å……ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬echoæ¨¡å—çš„æ¨¡å—ä¸»ä½“å®šä¹‰ï¼š</p>
<pre class="prettyprint linenums">ngx_module_t  ngx_http_echo_module = {
    NGX_MODULE_V1,
    &amp;ngx_http_echo_module_ctx,             /* module context */
    ngx_http_echo_commands,                /* module directives */
    NGX_HTTP_MODULE,                       /* module type */
    NULL,                                  /* init master */
    NULL,                                  /* init module */
    NULL,                                  /* init process */
    NULL,                                  /* init thread */
    NULL,                                  /* exit thread */
    NULL,                                  /* exit process */
    NULL,                                  /* exit master */
    NGX_MODULE_V1_PADDING
};</pre>
<p>å¼€å¤´å’Œç»“å°¾åˆ†åˆ«ç”¨NGX_MODULE_V1å’ŒNGX_MODULE_V1_PADDING å¡«å……äº†è‹¥å¹²å­—æ®µï¼Œå°±ä¸å»æ·±ç©¶äº†ã€‚è¿™é‡Œä¸»è¦éœ€è¦å¡«å…¥çš„ä¿¡æ¯ä»ä¸Šåˆ°ä¸‹ä»¥ä¾æ¬¡ä¸ºcontextã€æŒ‡ä»¤æ•°ç»„ã€æ¨¡å—ç±»å‹ä»¥åŠè‹¥å¹²ç‰¹å®šäº‹ä»¶çš„å›è°ƒå¤„ç†å‡½æ•°ï¼ˆä¸éœ€è¦å¯ä»¥ç½®ä¸ºNULLï¼‰ï¼Œå…¶ä¸­å†…å®¹è¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ï¼Œæ³¨æ„æˆ‘ä»¬çš„echoæ˜¯ä¸€ä¸ªHTTPæ¨¡å—ï¼Œæ‰€ä»¥è¿™é‡Œç±»å‹æ˜¯NGX_HTTP_MODULEï¼Œå…¶å®ƒå¯ç”¨ç±»å‹è¿˜æœ‰NGX_EVENT_MODULEï¼ˆäº‹ä»¶å¤„ç†æ¨¡å—ï¼‰å’ŒNGX_MAIL_MODULEï¼ˆé‚®ä»¶æ¨¡å—ï¼‰ã€‚</p>
<p>è¿™æ ·ï¼Œæ•´ä¸ªechoæ¨¡å—å°±å†™å¥½äº†ï¼Œä¸‹é¢ç»™å‡ºechoæ¨¡å—çš„å®Œæ•´ä»£ç ï¼š</p>
<pre class="prettyprint linenums">/*
* Copyright (C) Eric Zhang
*/
#include &lt;ngx_config.h&gt;
#include &lt;ngx_core.h&gt;
#include &lt;ngx_http.h&gt;
/* Module config */
typedef struct {
    ngx_str_t  ed;
} ngx_http_echo_loc_conf_t;
static char *ngx_http_echo(ngx_conf_t *cf, ngx_command_t *cmd, void *conf);
static void *ngx_http_echo_create_loc_conf(ngx_conf_t *cf);
static char *ngx_http_echo_merge_loc_conf(ngx_conf_t *cf, void *parent, void *child);
/* Directives */
static ngx_command_t  ngx_http_echo_commands[] = {
    { ngx_string(&quot;echo&quot;),
        NGX_HTTP_LOC_CONF|NGX_CONF_TAKE1,
        ngx_http_echo,
        NGX_HTTP_LOC_CONF_OFFSET,
        offsetof(ngx_http_echo_loc_conf_t, ed),
        NULL },
        ngx_null_command
};
/* Http context of the module */
static ngx_http_module_t  ngx_http_echo_module_ctx = {
    NULL,                                  /* preconfiguration */
    NULL,                                  /* postconfiguration */
    NULL,                                  /* create main configuration */
    NULL,                                  /* init main configuration */
    NULL,                                  /* create server configuration */
    NULL,                                  /* merge server configuration */
    ngx_http_echo_create_loc_conf,         /* create location configration */
    ngx_http_echo_merge_loc_conf           /* merge location configration */
};
/* Module */
ngx_module_t  ngx_http_echo_module = {
    NGX_MODULE_V1,
    &amp;ngx_http_echo_module_ctx,             /* module context */
    ngx_http_echo_commands,                /* module directives */
    NGX_HTTP_MODULE,                       /* module type */
    NULL,                                  /* init master */
    NULL,                                  /* init module */
    NULL,                                  /* init process */
    NULL,                                  /* init thread */
    NULL,                                  /* exit thread */
    NULL,                                  /* exit process */
    NULL,                                  /* exit master */
    NGX_MODULE_V1_PADDING
};
/* Handler function */
static ngx_int_t
ngx_http_echo_handler(ngx_http_request_t *r)
{
    ngx_int_t rc;
    ngx_buf_t *b;
    ngx_chain_t out;
    ngx_http_echo_loc_conf_t *elcf;
    elcf = ngx_http_get_module_loc_conf(r, ngx_http_echo_module);
    if(!(r-&gt;method &amp; (NGX_HTTP_HEAD|NGX_HTTP_GET|NGX_HTTP_POST)))
    {
        return NGX_HTTP_NOT_ALLOWED;
    }
    r-&gt;headers_out.content_type.len = sizeof(&quot;text/html&quot;) - 1;
    r-&gt;headers_out.content_type.data = (u_char *) &quot;text/html&quot;;
    r-&gt;headers_out.status = NGX_HTTP_OK;
    r-&gt;headers_out.content_length_n = elcf-&gt;ed.len;
    if(r-&gt;method == NGX_HTTP_HEAD)
    {
        rc = ngx_http_send_header(r);
        if(rc != NGX_OK)
        {
            return rc;
        }
    }
    b = ngx_pcalloc(r-&gt;pool, sizeof(ngx_buf_t));
    if(b == NULL)
    {
        ngx_log_error(NGX_LOG_ERR, r-&gt;connection-&gt;log, 0, &quot;Failed to allocate response buffer.&quot;);
        return NGX_HTTP_INTERNAL_SERVER_ERROR;
    }
    out.buf = b;
    out.next = NULL;
    b-&gt;pos = elcf-&gt;ed.data;
    b-&gt;last = elcf-&gt;ed.data + (elcf-&gt;ed.len);
    b-&gt;memory = 1;
    b-&gt;last_buf = 1;
    rc = ngx_http_send_header(r);
    if(rc != NGX_OK)
    {
        return rc;
    }
    return ngx_http_output_filter(r, &amp;out);
}
static char *
ngx_http_echo(ngx_conf_t *cf, ngx_command_t *cmd, void *conf)
{
    ngx_http_core_loc_conf_t  *clcf;
    clcf = ngx_http_conf_get_module_loc_conf(cf, ngx_http_core_module);
    clcf-&gt;handler = ngx_http_echo_handler;
    ngx_conf_set_str_slot(cf,cmd,conf);
    return NGX_CONF_OK;
}
static void *
ngx_http_echo_create_loc_conf(ngx_conf_t *cf)
{
    ngx_http_echo_loc_conf_t  *conf;
    conf = ngx_pcalloc(cf-&gt;pool, sizeof(ngx_http_echo_loc_conf_t));
    if (conf == NULL) {
        return NGX_CONF_ERROR;
    }
    conf-&gt;ed.len = 0;
    conf-&gt;ed.data = NULL;
    return conf;
}
static char *
ngx_http_echo_merge_loc_conf(ngx_conf_t *cf, void *parent, void *child)
{
    ngx_http_echo_loc_conf_t *prev = parent;
    ngx_http_echo_loc_conf_t *conf = child;
    ngx_conf_merge_str_value(conf-&gt;ed, prev-&gt;ed, &quot;&quot;);
    return NGX_CONF_OK;
}</pre>
<h1><a name="section3"></a>Nginxæ¨¡å—çš„å®‰è£…</h1>
<p>Nginxä¸æ”¯æŒåŠ¨æ€é“¾æ¥æ¨¡å—ï¼Œæ‰€ä»¥å®‰è£…æ¨¡å—éœ€è¦å°†æ¨¡å—ä»£ç ä¸Nginxæºä»£ç è¿›è¡Œé‡æ–°ç¼–è¯‘ã€‚å®‰è£…æ¨¡å—çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1ã€ç¼–å†™æ¨¡å—configæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶éœ€è¦æ”¾åœ¨å’Œæ¨¡å—æºä»£ç æ–‡ä»¶æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="prettyprint linenums">ngx_addon_name=æ¨¡å—å®Œæ•´åç§°
HTTP_MODULES=&quot;$HTTP_MODULES æ¨¡å—å®Œæ•´åç§°&quot;
NGX_ADDON_SRCS=&quot;$NGX_ADDON_SRCS $ngx_addon_dir/æºä»£ç æ–‡ä»¶å&quot;</pre>
<p>2ã€è¿›å…¥Nginxæºä»£ç ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤ç¼–è¯‘å®‰è£…</p>
<pre class="prettyprint linenums">./configure --prefix=å®‰è£…ç›®å½• --add-module=æ¨¡å—æºä»£ç æ–‡ä»¶ç›®å½•
make
make install</pre>
<p>è¿™æ ·å°±å®Œæˆå®‰è£…äº†ï¼Œä¾‹å¦‚ï¼Œæˆ‘çš„æºä»£ç æ–‡ä»¶æ”¾åœ¨/home/yefeng/ngxdev/ngx_http_echoä¸‹ï¼Œæˆ‘çš„configæ–‡ä»¶ä¸ºï¼š</p>
<pre class="prettyprint linenums">ngx_addon_name=ngx_http_echo_module
HTTP_MODULES=&quot;$HTTP_MODULES ngx_http_echo_module&quot;
NGX_ADDON_SRCS=&quot;$NGX_ADDON_SRCS $ngx_addon_dir/ngx_http_echo_module.c&quot;</pre>
<p>ç¼–è¯‘å®‰è£…å‘½ä»¤ä¸ºï¼š</p>
<pre class="prettyprint linenums">./configure --prefix=/usr/local/nginx --add-module=/home/yefeng/ngxdev/ngx_http_echo
make
sudo make install</pre>
<p>è¿™æ ·echoæ¨¡å—å°±è¢«å®‰è£…åœ¨æˆ‘çš„Nginxä¸Šäº†ï¼Œä¸‹é¢æµ‹è¯•ä¸€ä¸‹ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¢åŠ ä»¥ä¸‹ä¸€é¡¹é…ç½®ï¼š</p>
<pre class="prettyprint linenums">location /echo {
    echo &quot;This is my first nginx module!!!&quot;;
}</pre>
<p>ç„¶åç”¨curlæµ‹è¯•ä¸€ä¸‹ï¼š</p>
<pre class="prettyprint linenums">curl -i http://localhost/echo</pre>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p class="picture"><img alt="" src="/uploads/pictures/intro-of-nginx-module-development/4.png"/></p>
<p>å¯ä»¥çœ‹åˆ°æ¨¡å—å·²ç»æ­£å¸¸å·¥ä½œäº†ï¼Œä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç½‘å€ï¼Œå°±å¯ä»¥çœ‹åˆ°ç»“æœï¼š</p>
<p class="picture"><img alt="" src="/uploads/pictures/intro-of-nginx-module-development/5.png"/></p>
<h1><a name="section4"></a>æ›´æ·±å…¥çš„å­¦ä¹ </h1>
<p>æœ¬æ–‡åªæ˜¯ç®€è¦ä»‹ç»äº†Nginxæ¨¡å—çš„å¼€å‘è¿‡ç¨‹ï¼Œç”±äºç¯‡å¹…çš„åŸå› ï¼Œä¸èƒ½é¢é¢ä¿±åˆ°ã€‚å› ä¸ºç›®å‰Nginxçš„å­¦ä¹ èµ„æ–™å¾ˆå°‘ï¼Œå¦‚æœè¯»è€…å¸Œæœ›æ›´æ·±å…¥å­¦ä¹ Nginxçš„åŸç†åŠæ¨¡å—å¼€å‘ï¼Œé‚£ä¹ˆé˜…è¯»æºä»£ç æ˜¯æœ€å¥½çš„åŠæ³•ã€‚åœ¨Nginxæºä»£ç çš„core/ä¸‹æ”¾æœ‰Nginxçš„æ ¸å¿ƒä»£ç ï¼Œå¯¹ç†è§£Nginxçš„å†…éƒ¨å·¥ä½œæœºåˆ¶éå¸¸æœ‰å¸®åŠ©ï¼Œhttp/ç›®å½•ä¸‹æœ‰Nginx HTTPç›¸å…³çš„å®ç°ï¼Œhttp/moduleä¸‹æ”¾æœ‰å¤§é‡å†…ç½®httpæ¨¡å—ï¼Œå¯ä¾›è¯»è€…å­¦ä¹ æ¨¡å—çš„å¼€å‘ï¼Œå¦å¤–åœ¨<a title="http://wiki.nginx.org/3rdPartyModules" href="http://wiki.nginx.org/3rdPartyModules">http://wiki.nginx.org/3rdPartyModules</a>ä¸Šæœ‰å¤§é‡ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œä¹Ÿæ˜¯éå¸¸å¥½çš„å­¦ä¹ èµ„æ–™ã€‚</p>
<p>å¦‚æœ‰æ„è§å»ºè®®æˆ–ç–‘é—®æ¬¢è¿å‘é€é‚®ä»¶è‡³<a href="mailto:ericzhang.buaa@gmail.com">ericzhang.buaa@gmail.com</a>ã€‚å¸Œæœ›æœ¬æ–‡å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼ï¼ï¼</p>
<h1><a name="section5"></a>å‚è€ƒæ–‡çŒ®</h1>
<p>[1] Evan Miller, Emiller's Guide To Nginx Module Development. <a title="http://www.evanmiller.org/nginx-modules-guide.html" href="http://www.evanmiller.org/nginx-modules-guide.html">http://www.evanmiller.org/nginx-modules-guide.html</a>, 2009</p>
<p>[2] <a title="http://wiki.nginx.org/Configuration" href="http://wiki.nginx.org/Configuration">http://wiki.nginx.org/Configuration</a></p>
<p>[3] ClÃ©ment Nedelcu, Nginx Http Server. Packt Publishing, 2010</p>

        </div>
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c74f9b0c9ea5242"></script>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_inline_share_toolbox"></div>

    </div>
</div>
        <div id="footer">
            <div id="footer-inner">
                <p id="copyright">Copyright (c) 2011-2019 CodingLabs æœ¬åšå®¢å†…å®¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by/3.0/cn/" target="_blank">çŸ¥è¯†å…±äº«ç½²å 3.0 ä¸­å›½å¤§é™†è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯</p>
            </div>
        </div>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                tex2jax: {
                    inlineMath: [['$','$'], ['\\(','\\)']],
                    processEscapes: true
                }
            });
        </script>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </body>
</html>

