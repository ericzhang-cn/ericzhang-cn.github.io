<!doctype html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="description" content="keep coding, keep foolish"/>
        <meta name="keywords" content="ä»£ç ,æ•°å­¦,æ•°æ®æŒ–æ˜,æœºå™¨å­¦ä¹ ,ç®—æ³•,ç¼–è¯‘å™¨,åˆ†å¸ƒå¼,PHP,Nginx"/>
        <meta name="author" content="å¼ æ´‹"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
        <title>CodingLabs - å‘å¸ƒä¸€ä¸ªæŸ¥çœ‹PHP opcodeçš„æ‰©å±•æ¨¡å—åŠWebæœåŠ¡
</title>
        <link rel="stylesheet" href="/assets/vendor/normalize.css"/>
        <link rel="stylesheet" href="/assets/vendor/google-code-prettify/prettify-solarized-dark.css"/>
        <link rel="stylesheet" href="/assets/themes/default/main.css"/>
        <link rel="shortcut icon" href="/fav.ico"/>
        <script type="text/javascript" src="/assets/vendor/google-code-prettify/prettify.js"></script>
        <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F75dfda8ff8a93fa0b94adeb17da37a2f' type='text/javascript'%3E%3C/script%3E"));
</script>

    </head>
    <body onload="prettyPrint()">
    <div id="header">
        <div id="header-inner">
            <div id="title"><a href="/">CodingLabs</a></div>
            <div id="subtitle">keep coding, keep foolish</div>
        </div>
    </div>

<div id="main">
    <div id="main-inner">
        <div id="topnav">
            <ul>
                <li><a href="/">é¦–é¡µ</a></li>
                <li class="sep"> | </li>
                <li><a href="/tag.html">æ ‡ç­¾</a></li>
                
<li class="sep"> | </li>
<li><a href="/pages/about-me.html" target="_self">å…³äºæˆ‘</a></li>

<li class="sep"> | </li>
<li><a href="/rss.xml" target="_self">+è®¢é˜…</a></li>

<li class="sep"> | </li>
<li><a href="https://github.com/ericzhang-cn/ailingbot" target="_blank">ğŸ¤–AilingBot - IMæœºå™¨äººæ¥å…¥AIèƒ½åŠ›çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ</a></li>


            </ul>
            <div style="clear:both;"></div>
        </div>
        <div id="article-title">
            <a href="/articles/opdumper-and-web-opcode-dumper.html">å‘å¸ƒä¸€ä¸ªæŸ¥çœ‹PHP opcodeçš„æ‰©å±•æ¨¡å—åŠWebæœåŠ¡</a>
        </div>
        <div id="article-meta">
            ä½œè€… å¼ æ´‹ | å‘å¸ƒäº 2012-05-16
        </div>
        <div id="article-tags">
        
        <a class="tag" href="/tag.html#PHP">PHP</a>
        
        <a class="tag" href="/tag.html#Opcode">Opcode</a>
        
        <a class="tag" href="/tag.html#ZendEngine">ZendEngine</a>
        
        </div>
        <div id="article-content">
            <p>æœ€è¿‘èŠ±äº†å¤§çº¦ä¸€æ˜ŸæœŸçš„æ—¶é—´å†™äº†ä¸€ä¸ªPHPæ‰©å±•æ¨¡å—<a href="https://github.com/ericzhang-cn/opdumper" target="_blank">Opdumer</a>ï¼Œå¹¶å°è£…æˆäº†WebæœåŠ¡ï¼ˆ<a href="http://supercompiler.com/app/opcode_dumper" target="_blank">ç‚¹å‡»è¿™é‡Œè®¿é—®</a>ï¼‰ã€‚è¿™ä¸ªæ¨¡å—çš„ä¸»è¦å†…å®¹æ˜¯è¾“å‡ºPHPä»£ç å¯¹åº”çš„opcodeã€‚å…¶å®ä¹‹å‰å·²ç»æœ‰ä¸€äº›ç”¨äºæŸ¥çœ‹opcodeçš„æ‰©å±•æ¨¡å—ï¼Œå¦‚æ¯”è¾ƒæœ‰åçš„<a href="http://pecl.php.net/package/vld" target="_blank">vld</a>ã€‚ä¹‹æ‰€ä»¥é‡æ–°å®ç°ä¸€ä¸ªè¿™æ ·çš„æ¨¡å—ï¼Œä¸»è¦æ˜¯å› ä¸ºvldä¸æ”¯æŒPHP_FUNCTION APIï¼Œä¹Ÿå°±æ˜¯è¯´vldåªèƒ½ç”¨äºCLIå½¢å¼ï¼Œè€ŒOpdumeråŒæ—¶æ‹¥æœ‰CLI APIå’ŒPHP_FUNCTION APIï¼Œå¦å¤–ï¼Œä¹Ÿæƒ³å€ŸåŠ©ç¼–å†™è¿™ä¸ªæ¨¡å—çš„æœºä¼šå­¦ä¹ Zend Engineä¸­opcodeçš„ç¼–è¯‘å’Œæ‰§è¡Œæœºåˆ¶ã€‚ä¸ªäººæ‰“ç®—åé¢ä¸“é—¨é’ˆå¯¹opcodeçš„ç¼–è¯‘æ‰§è¡Œæœºåˆ¶å†™ä¸€ç¯‡æ–‡ç« ï¼Œè€Œæœ¬æ–‡ä¸»è¦æè¿°Opcodeçš„ä½¿ç”¨æ–¹æ³•åŠå¯¹åº”WebæœåŠ¡çš„ä½¿ç”¨ã€‚</p>
<!--more-->
<h1>Opdumper</h1>
<h2>å®‰è£…</h2>
<p>Opdumperçš„æºç å·²ç»æ‰˜ç®¡åœ¨githubä¸Šï¼Œå…¶åœ°å€ä¸ºï¼š<a href="https://github.com/ericzhang-cn/opdumper" target="_blank">https://github.com/ericzhang-cn/opdumper</a>ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å…‹éš†æºä»£ç ï¼š</p>
<pre class="prettyprint linenums">git clone https://github.com/ericzhang-cn/opdumper.git</pre>
<p>Opdumperæ˜¯ä¸€ä¸ªæ ‡å‡†çš„PHP Extensionï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<p>é¦–å…ˆå°†Opdumperæºç æ”¾åˆ°PHPæºç åŒ…çš„ext/opdumperç›®å½•ä¸‹ï¼Œè¿›å…¥æ­¤ç›®å½•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre class="prettyprint linenums">phpize
./configure
make
make install</pre>
<p>ç„¶ååœ¨php.iniä¸­æ·»åŠ ä¸€è¡Œé…ç½®ï¼š</p>
<pre class="prettyprint linenums">extension=opdumper.so</pre>
<p>ç›®å‰opdumperæ”¯æŒPHP&gt;=5.3ï¼Œåœ¨Linuxå’ŒMacOSä¸‹æµ‹è¯•é€šè¿‡ï¼ŒWindowsä¸‹æœªåšæµ‹è¯•ã€‚</p>
<h2>CLI API</h2>
<p>Opdumperæ”¯æŒç±»ä¼¼vldçš„å‘½ä»¤è¡Œæ–¹å¼è¾“å‡ºopcodeï¼Œåªéœ€åœ¨æ‰§è¡Œphpå‘½ä»¤æ—¶é€šè¿‡-då‚æ•°å°†opdumper.active=1ä¼ å…¥ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªfoo.phpï¼š</p>
<pre class="prettyprint linenums">&lt;?php
$a = 'hello';
echo $a;
?&gt;</pre>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre class="prettyprint linenums">php -d opdumper.active=1 foo.php</pre>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p class="picture"><img alt="" src="/uploads/pictures/opdumper-and-web-opcode-dumper/1.png"/></p>
<h2>PHP_FUNCTION API</h2>
<p>Opdumperè¿˜æ”¯æŒvldä¸æ”¯æŒçš„PHP_FUNCTION APIï¼ŒOpdumperæä¾›äº†ä¸¤ä¸ªPHPå‡½æ•°ï¼šod_dump_opcodes_stringå’Œod_dump_opcodes_fileã€‚å‰è€…æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºäº§ç”Ÿï¼Œå­—ç¬¦ä¸²æ˜¯ä¸€æ®µPHPä»£ç ï¼›åè€…æ¥å—ä¸€ä¸ªPHPæ–‡ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿”å›å€¼å‡æ˜¯ä¸€ä¸ªå­˜æœ‰opcodeç»“æœçš„PHPæ•°ç»„ã€‚ä»¥od_dump_opcodes_fileä¸ºä¾‹ï¼Œæˆ‘ä»¬åœ¨foo.phpåŒä¸€ç›®å½•ä¸‹å†å†™ä¸€ä¸ªbar.phpï¼š</p>
<pre class="prettyprint linenums">&lt;?php
$opcodes = od_dump_opcodes_file('./foo.php');
var_dump($opcodes);
?&gt;</pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre class="prettyprint linenums">array(3) {
    [0]=&gt;
    array(8) {
        ["lineno"]=&gt;
        int(2)
            ["opcode"]=&gt;
        string(11) "ZEND_ASSIGN"
            ["op1_type"]=&gt;
        string(2) "CV"
            ["op2_type"]=&gt;
        string(5) "CONST"
            ["result_type"]=&gt;
        string(0) ""
            ["op1"]=&gt;
        string(2) "~0"
            ["op2"]=&gt;
        string(5) "hello"
            ["result"]=&gt;
        string(0) ""
    }
    [1]=&gt;
    array(8) {
        ["lineno"]=&gt;
        int(3)
            ["opcode"]=&gt;
        string(9) "ZEND_ECHO"
            ["op1_type"]=&gt;
        string(2) "CV"
            ["op2_type"]=&gt;
        string(6) "UNUSED"
            ["result_type"]=&gt;
        string(6) "UNUSED"
            ["op1"]=&gt;
        string(2) "~0"
            ["op2"]=&gt;
        string(6) "UNUSED"
            ["result"]=&gt;
        string(6) "UNUSED"
    }
    [2]=&gt;
    array(8) {
        ["lineno"]=&gt;
        int(5)
            ["opcode"]=&gt;
        string(11) "ZEND_RETURN"
            ["op1_type"]=&gt;
        string(5) "CONST"
            ["op2_type"]=&gt;
        string(6) "UNUSED"
            ["result_type"]=&gt;
        string(6) "UNUSED"
            ["op1"]=&gt;
        string(1) "1"
            ["op2"]=&gt;
        string(6) "UNUSED"
            ["result"]=&gt;
        string(6) "UNUSED"
    }
}</pre>
<h1>Opdumperçš„WebæœåŠ¡ï¼šOpcode Dumper</h1>
<p>å¦ç™½è¯´ï¼Œå®‰è£…PHPæ¨¡å—è¿˜æ˜¯æŒºéº»çƒ¦çš„ã€‚æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿æœ‹å‹ä»¬æŸ¥çœ‹opcodeï¼Œæˆ‘ä¸ºOpdumperæ­å»ºäº†ä¸€ä¸ªåœ¨çº¿WebæœåŠ¡ï¼š<a href="http://supercompiler.com/app/opcode_dumper" target="_blank">http://supercompiler.com/app/opcode_dumper</a>ã€‚</p>
<h2>Webé¡µé¢è®¿é—®</h2>
<p>åªè¦è®¿é—®è¿™ä¸ªé¡µé¢ï¼Œåœ¨ç¼–è¾‘æ¡†ä¸­è¾“å…¥æˆ–ç²˜è´´è¿›PHPä»£ç ï¼Œå°±å¯ä»¥å¿«é€Ÿçœ‹åˆ°ç›¸åº”çš„opcodeï¼š</p>
<p class="picture"><img alt="" src="/uploads/pictures/opdumper-and-web-opcode-dumper/2.png"/></p>
<h2>HTTP APIæ–¹å¼è®¿é—®</h2>
<p>æ‚¨å¯ä»¥é€šè¿‡è®¿é—®å¦‚ä¸‹APIè·å–PHPä»£ç çš„opcodeï¼š</p>
<p>URI: <b>http://supercompiler.com/api/dump_opcodes</b></p>
<p>Method: <b>POST</b></p>
<p>Params: <b>php_script=[æ‚¨çš„PHPä»£ç ]</b></p>
<p>è¿”å›å€¼ä¸ºJSONæ ¼å¼ï¼ŒæˆåŠŸæ—¶successå­—æ®µä¸º"true"ï¼Œdataå­—æ®µå­˜å‚¨opcodesï¼›å¤±è´¥æ—¶successå­—æ®µä¸º"false"ï¼Œmsgå­—æ®µå­˜æ”¾å¤±è´¥åŸå› ã€‚</p>
<p>ç”±äºè·¨è¶Šçš„å…³ç³»ï¼Œç›®å‰åªèƒ½ä½¿ç”¨Curlè€Œä¸èƒ½ä½¿ç”¨Ajaxæ–¹å¼è°ƒç”¨è¿™ä¸ªAPIï¼Œåç»­ä¼šä¸ºå…¶å¢åŠ JSONPæ¥å£ã€‚</p>
<h1>ç»“è¯­</h1>
<p>ç›®å‰è¿™ä¸ªæ¨¡å—è¿˜æ¯”è¾ƒåˆçº§ï¼Œæœ‰å¾ˆå¤šéœ€è¦å®Œå–„çš„åœ°æ–¹ã€‚ä¹Ÿæ¬¢è¿æœ‰å…´è¶£çš„æœ‹å‹é€šè¿‡githubè´¡çŒ®ä»£ç ã€‚</p>

        </div>
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c74f9b0c9ea5242"></script>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_inline_share_toolbox"></div>

    </div>
</div>
        <div id="footer">
            <div id="footer-inner">
                <p id="copyright">Copyright (c) 2011-2019 CodingLabs æœ¬åšå®¢å†…å®¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by/3.0/cn/" target="_blank">çŸ¥è¯†å…±äº«ç½²å 3.0 ä¸­å›½å¤§é™†è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯</p>
            </div>
        </div>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                tex2jax: {
                    inlineMath: [['$','$'], ['\\(','\\)']],
                    processEscapes: true
                }
            });
        </script>
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </body>
</html>

